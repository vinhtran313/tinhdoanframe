<!DOCTYPE html>
<html lang="en">

  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ch√†o m·ª´ng ƒê·∫°i h·ªôi ƒë·∫°i bi·ªÉu ƒêo√†n TNCS H·ªì Ch√≠ Minh t·ªânh Ngh·ªá An l·∫ßn th·ª© XIX, nhi·ªám k·ª≥ 2025 - 2030</title>
    <meta property="og:title"
      content="Ch√†o m·ª´ng ƒê·∫°i h·ªôi ƒë·∫°i bi·ªÉu ƒêo√†n TNCS H·ªì Ch√≠ Minh t·ªânh Ngh·ªá An l·∫ßn th·ª© XIX, nhi·ªám k·ª≥ 2025 - 2030" />
    <meta property="og:description"
      content="Ch√†o m·ª´ng ƒê·∫°i h·ªôi ƒë·∫°i bi·ªÉu ƒêo√†n TNCS H·ªì Ch√≠ Minh t·ªânh Ngh·ªá An l·∫ßn th·ª© XIX, nhi·ªám k·ª≥ 2025 - 2030" />
    <meta property="og:image"
      content="https://tinhdoannghean.vn/wp-content/uploads/z7185959737439_12ec69de1ee9cd2d3c5fe574dcddc806.jpg" />
    <meta property="og:url" content="http://tinhdoannghean.vn/guiloiyeuthuongtoidaihoidoan/" />
    <meta property="og:type" content="website" />

    <link rel="icon" type="image/x-icon" href="assets/favicon.png">
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/cropperjs/1.6.2/cropper.min.css"
      integrity="sha512-UtLOu9C7NuThQhuXXrGwx9Jb/z9zPQJctuAgNUBK3Z6kkSYT9wJ+2+dh6klS+TDBCV9kNPBbAxbVD+vCcfGPaA=="
      crossorigin="anonymous" referrerpolicy="no-referrer" />
    <script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/dom-to-image/2.6.0/dom-to-image.js"
      integrity="sha512-wUa0ktp10dgVVhWdRVfcUO4vHS0ryT42WOEcXjVVF2+2rcYBKTY7Yx7JCEzjWgPV+rj2EDUr8TwsoWF6IoIOPg=="
      crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    <link rel="stylesheet" href="main.v1.1.css">

  </head>

  <body>
    <div class=" main-wrapper">
      <div
        class="flex max-w-[1200px] mx-auto items-center justify-between pt-[30px] sm:py-[20px] gap-[16px] sm:gap-[32px] px-[16px]">
        <img src="assets/huyhieudoan.png" class="sm:w-[90px] w-[32px]" />
        <div class="flex1">
          <img src="assets/chudaihoi.png" class="w-full" />
        </div>
      </div>
      <div class="sm:pt-[30px] pt-[20px] mx-auto flex justify-center ">
        <div class="flex sm:gap-[50px] gap-[20px] max-w-[1200px] flex-col sm:flex-row">
          <div class="input-place flex flex-col gap-[10px] sm:w-[350px] w-full">
            <div class="input-group mb-[10px]">
              <label for="image-choose" class="text-white cursor-pointer">
                <span class="cursor-pointer">
                  Ch·ªçn ·∫£nh
                </span>
              </label>
              <input type="file" id="image-choose" name="avatar" accept="image/*" class="hidden" />
            </div>
            <div class="input-group flex flex-col gap-[10px]">
              <label for="name" class="text-white">
                <span>H·ªç v√† t√™n</span>
              </label>
              <div class="gradient-border-wrapper">
                <input type="text" id="name" class="gradient-border h-[40px]" placeholder="H·ªç v√† t√™n..." />
              </div>
            </div>
            <div class="input-group flex flex-col gap-[10px]">
              <label for="title" class="text-white">
                <span>Ch·ª©c v·ª•</span>
              </label>
              <div class="gradient-border-wrapper">
                <textarea type="text" id="title" class=" gradient-border" placeholder="Ch·ª©c v·ª•..." rows="2"></textarea>
              </div>
            </div>
            <div class="input-group flex flex-col gap-[10px]">
              <label for="message" class="text-white">
                <span>G·ª≠i l·ªùi nh·∫Øn ƒë·∫øn ƒë·∫°i h·ªôi</span>
              </label>
              <div class="gradient-border-wrapper">
                <textarea id="message" rows="5" class="gradient-border" placeholder="L·ªùi nh·∫Øn..."></textarea>
              </div>
            </div>
            <div class="input-group flex flex-col gap-[10px]">
              <div class="gradient-border-wrapper cursor-pointer">
                <button id="submit" rows="5" class="gradient-border text-white font-bold">T·∫°o l·ªùi nh·∫Øn</button>
              </div>
            </div>
          </div>
          <div class="frame-wrapper sm:max-w-[800px] sm:w-[800px] max-w-[350px] w-[350px]" id="frame-wrapper">
            <img src="assets/daihoitncs.png" alt="" class="w-full">
            <div class="name">
              <span class="name-content"></span>
            </div>
            <div class="title">
              <span class="title-content"></span>
            </div>
            <div class="image-choosen">
              <img id="img-choosen" src="assets/placeholder.jpg" alt="" class="w-full h-full" />
            </div>
            <div class="message">
              <p class="message-content"></p>
            </div>
          </div>
        </div>
      </div>
    </div>
    <div id="cropperModal" class="modal">
      <div class="modal-content">
        <span class="close">&times;</span>
        <h2 class="text-2xl mb-4">C·∫Øt ·∫£nh</h2>
        <div class="relative w-full h-96">
          <img id="cropperImage" src="" alt="Cropper Image" class="absolute top-0 left-0 w-full h-full">
        </div>
        <button id="saveCroppedImage" class="mt-5 bg-blue-500 text-white py-2 px-4 rounded">L∆∞u</button>
      </div>
    </div>
    <div class="loader-wrapper" style="display: none;">
      <div id="loader" class="loader"></div>
    </div>
  </body>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/cropperjs/1.6.2/cropper.min.js"
    integrity="sha512-JyCZjCOZoyeQZSd5+YEAcFgz2fowJ1F1hyJOXgtKu4llIa0KneLcidn5bwfutiehUTiOuK87A986BZJMko0eWQ=="
    crossorigin="anonymous" referrerpolicy="no-referrer"></script>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-app.js";
    import { getAuth, signInAnonymously } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-auth.js";
    import {
      getStorage,
      ref,
      uploadBytes,
      getDownloadURL,
      listAll,
      getMetadata,
      deleteObject  // ‚Üê Th√™m import n√†y
    } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-storage.js";

    const firebaseConfig = {
      apiKey: "AIzaSyC-BybEM7o4XRwM0l_sXdzwtf__OVxtpts",
      authDomain: "daihoidoan-3e3c1.firebaseapp.com",
      projectId: "daihoidoan-3e3c1",
      storageBucket: "daihoidoan-3e3c1.firebasestorage.app",
      messagingSenderId: "828189974969",
      appId: "1:828189974969:web:1d42d1b0cfcfbed4ca9668"
    };

    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const storage = getStorage(app);

    signInAnonymously(auth)
      .then(() => console.log("‚úÖ Anonymous login th√†nh c√¥ng"))
      .catch((error) => console.error("‚ùå L·ªói ƒëƒÉng nh·∫≠p:", error));

    // import { ref, listAll, getMetadata, deleteObject } from "firebase/storage";

    async function cleanupOldImages() {
      try {
        const oneMinuteAgo = Date.now() - 15 * 60 * 1000; // 1 ph√∫t tr∆∞·ªõc
        const storageRef = ref(storage, 'images');
        const listResult = await listAll(storageRef);
        console.log(listResult)

        // D√πng map ƒë·ªÉ ch·∫°y song song, tr√°nh ch·ªù t·ª´ng c√°i
        const deletePromises = listResult.items.map(async (itemRef) => {
          try {
            const metadata = await getMetadata(itemRef);
            if (!metadata.timeCreated) return;

            const createdAt = new Date(metadata.timeCreated).getTime();

            if (createdAt < oneMinuteAgo) {
              await deleteObject(itemRef);
              console.log(`üóëÔ∏è X√≥a ·∫£nh: ${itemRef.name}`);
            }
          } catch (err) {
            console.warn(`‚ö†Ô∏è Kh√¥ng th·ªÉ x·ª≠ l√Ω ${itemRef.name}:`, err);
          }
        });

        await Promise.all(deletePromises);
        console.log("‚úÖ D·ªçn d·∫πp ho√†n t·∫•t.");

      } catch (error) {
        console.error("‚ùå L·ªói khi x√≥a ·∫£nh:", error);
      }
    }

    async function uploadImage(file) {
      if (!file) return alert("Ch∆∞a ch·ªçn ·∫£nh!");

      if (file.size > 10 * 1024 * 1024) {
        alert("·∫¢nh qu√° 10MB!");
        return;
      }

      const fileName = `images/${Date.now()}_${file.name}`;
      const fileRef = ref(storage, fileName);

      try {
        await uploadBytes(fileRef, file);
        const url = await getDownloadURL(fileRef);
        console.log("‚úÖ Upload th√†nh c√¥ng:", url);
        alert("·∫¢nh ƒë√£ upload:\n" + url);
      } catch (err) {
        console.error("‚ùå Upload l·ªói:", err);
        alert("Upload th·∫•t b·∫°i!");
      }
    }
    let cropper;
    const imageChoose = document.getElementById("image-choose");
    const imgChoosen = document.getElementById("img-choosen");
    const cropperImage = document.getElementById("cropperImage");
    const cropperModal = document.getElementById("cropperModal");
    const saveCroppedImage = document.getElementById("saveCroppedImage");
    const closeModal = document.querySelector(".close");
    const nameInput = document.getElementById("name");
    const titleInput = document.getElementById("title");
    const messageInput = document.getElementById("message");
    const submitBtn = document.getElementById("submit");
    const loaderWrapper = document.querySelector(".loader-wrapper");

    function resetInput() {
      imageChoose.value = "";
      if (cropper) {
        cropper.destroy();
        cropper = null;
      }
    }

    imageChoose.addEventListener("change", function () {
      const files = this.files;
      if (files.length > 0) {
        const file = files[0];
        const reader = new FileReader();
        reader.onload = function (event) {
          cropperImage.src = event.target.result;
          cropperModal.style.display = "block";
          if (cropper) {
            cropper.destroy();
          }
          cropper = new Cropper(cropperImage, {
            aspectRatio: 1,
            viewMode: 1,
          });
        };
        reader.readAsDataURL(file);
      }
    });

    saveCroppedImage.addEventListener("click", function () {
      if (cropper) {
        const canvas = cropper.getCroppedCanvas();
        const base64encodedImage = canvas.toDataURL("image/jpeg");
        imgChoosen.src = base64encodedImage;
        cropperModal.style.display = "none";
        resetInput();
      }
    });

    closeModal.addEventListener("click", function () {
      cropperModal.style.display = "none";
      resetInput();
    });

    window.addEventListener("click", function (event) {
      if (event.target === cropperModal) {
        cropperModal.style.display = "none";
        resetInput();
      }
    });

    nameInput.addEventListener("input", function () {
      const nameContent = document.querySelector(".name-content");
      if (nameContent) {
        nameContent.textContent = this.value;
      }
    });

    titleInput.addEventListener("input", function () {
      const titleContent = document.querySelector(".title-content");
      if (titleContent) {
        titleContent.innerHTML = this.value.replace(/\n/g, "<br>");
      }
    });

    messageInput.addEventListener("input", function () {
      const messageContent = document.querySelector(".message-content");
      if (messageContent) {
        messageContent.textContent = this.value;
      }
    });
    await signInAnonymously(auth).catch(console.error);
    submitBtn.addEventListener("click", async () => {
      loaderWrapper.style.display = "flex";
      const node = document.getElementById("frame-wrapper");

      const scaleObject = window.innerWidth < 768 ? 3 : 2;
      const options = {
        width: node.offsetWidth * scaleObject,
        height: node.offsetHeight * scaleObject,
        style: {
          transform: "scale(" + scaleObject + ")",
          transformOrigin: "top left",
        },
        quality: 1,
      };
      try {
        await cleanupOldImages();

        domtoimage.toPng(node, options)
          .then(function (dataUrl) {
            return domtoimage.toPng(node, options);
          })
          .then(async (data1) => {
            const response = await fetch(data1);
            const blob = await response.blob();

            if (blob.size > 10 * 1024 * 1024) {
              alert("·∫¢nh qu√° l·ªõn (tr√™n 10MB)!");
              loaderWrapper.style.display = "none";
              return;
            }

            // ‚òÅÔ∏è Upload l√™n Firebase Storage
            const fileRef = ref(storage, `images/${Date.now()}.png`);
            await uploadBytes(fileRef, blob);
            const imageUrl = await getDownloadURL(fileRef);

            loaderWrapper.style.display = "none";

            // üñº Hi·ªÉn th·ªã ·∫£nh
            const img = new Image();
            img.src = imageUrl;
            img.alt = "L·ªùi y√™u th∆∞∆°ng";
            img.style.maxWidth = "100%";
            img.style.borderRadius = "12px";
            img.style.boxShadow = "0 2px 8px rgba(0,0,0,0.2)";
            img.style.marginTop = "10px";
            console.log(imageUrl);
            node.innerHTML = "";
            node.appendChild(img);

            // üìÇ N√∫t m·ªü tab m·ªõi
            const btnWrapper = document.createElement("div");
            btnWrapper.style.display = "flex";
            btnWrapper.style.justifyContent = "center";
            btnWrapper.style.flexWrap = "wrap";
            btnWrapper.style.gap = "10px";
            btnWrapper.style.marginTop = "10px";
            node.appendChild(btnWrapper);

            // üìã N√∫t sao ch√©p link ·∫£nh
            const copyBtn = document.createElement("button");
            copyBtn.textContent = "üìã Sao ch√©p ƒë∆∞·ªùng d·∫´n ·∫£nh";
            copyBtn.style.background = "#9C27B0";
            copyBtn.style.color = "white";
            copyBtn.style.padding = "10px 14px";
            copyBtn.style.border = "none";
            copyBtn.style.borderRadius = "8px";
            copyBtn.style.cursor = "pointer";
            copyBtn.style.fontFamily = "system-ui, sans-serif";
            btnWrapper.appendChild(copyBtn);

            const reloadBtn = document.createElement("button");
            reloadBtn.textContent = "üîÑ T·∫°o m·ªõi";
            Object.assign(reloadBtn.style, {
              background: "rgb(243,132,33)",
              color: "white",
              padding: "10px 14px",
              border: "none",
              borderRadius: "8px",
              cursor: "pointer",
              fontFamily: "system-ui, sans-serif",
            });
            btnWrapper.appendChild(reloadBtn);

            copyBtn.addEventListener("click", async () => {
              try {
                await navigator.clipboard.writeText(imageUrl);
                copyBtn.textContent = "‚úÖ ƒê√£ sao ch√©p!";
                setTimeout(() => (copyBtn.textContent = "üìã Sao ch√©p ƒë∆∞·ªùng d·∫´n ·∫£nh"), 2000);
              } catch (err) {
                console.log(err);
                alert("Kh√¥ng th·ªÉ sao ch√©p, vui l√≤ng t·ª± copy ƒë∆∞·ªùng d·∫´n ·∫£nh.");
              }
            });

            reloadBtn.addEventListener("click", () => {
              location.reload();
            });

            // ü™ß Popup h∆∞·ªõng d·∫´n
            const popup = document.createElement("div");
            popup.innerHTML = `
  <div style="
    position: fixed;
    top: 0; left: 0;
    width: 100%; height: 100%;
    background: rgba(0,0,0,0.6);
    display: flex; align-items: center; justify-content: center;
    z-index: 9999;">
    <div style="
      background: white; padding: 20px; border-radius: 12px; text-align: center;
      max-width: 340px; font-family: system-ui, sans-serif;">
      
      <p style="font-size: 16px; font-weight: 600; margin-bottom: 10px;">
        ‚úÖ L·ªùi nh·∫Øn c·ªßa b·∫°n ƒë√£ s·∫µn s√†ng!
      </p>
      
      <p style="font-size: 14px; color: #444; margin-bottom: 10px; line-height: 1.5;">
        Vui l√≤ng ch·ªù ·∫£nh hi·ªÉn th·ªã ho√†n t·∫•t, sau ƒë√≥:
      </p>

      <ul style="text-align: left; color: #555; font-size: 13px; line-height: 1.5; margin: 0 0 12px 20px; padding: 0;">
        <li>üì∑ Nh·∫•n v√† gi·ªØ v√†o ·∫£nh, ch·ªçn <b>T·∫£i ·∫£nh</b> ho·∫∑c <b>L∆∞u ·∫£nh xu·ªëng</b> (tu·ª≥ thi·∫øt b·ªã).</li>
        <li>üîó Ho·∫∑c sao ch√©p ƒë∆∞·ªùng d·∫´n ·∫£nh ƒë·ªÉ s·ª≠ d·ª•ng sau n√†y. (ƒê∆∞·ªùng d·∫´n ch·ªâ c√≥ hi·ªáu l·ª±c trong 15 ph√∫t k·ªÉ t·ª´ l√∫c t·∫°o l·ªùi nh·∫Øn)</li>
      </ul>

      <p style="font-size: 12px; color: #777; margin-bottom: 14px;">
        ‚ö†Ô∏è  Xin l·ªói v√¨ s·ª± b·∫•t ti·ªán kh√¥ng th·ªÉ t·∫£i ·∫£nh tr·ª±c ti·∫øp v·ªÅ m√°y do gi·ªõi h·∫°n b·∫£o m·∫≠t c·ªßa Zalo/Facebook. Vui l√≤ng l√†m theo c√°ch th·ªß c√¥ng ·ªü tr√™n.
      </p>

      <div style="display: flex; justify-content: center; gap: 10px;">
        <button id="closePopup" style="
          background: #4CAF50; color: white; border: none;
          padding: 8px 14px; border-radius: 6px; cursor: pointer;">
          ƒê√£ hi·ªÉu
        </button>
        <button id="reloadPage" style="
          background: #2196F3; color: white; border: none;
          padding: 8px 14px; border-radius: 6px; cursor: pointer;">
          üîÑ T·∫°o m·ªõi
        </button>
      </div>
    </div>
  </div>`;
            document.body.appendChild(popup);
            document.getElementById("closePopup").onclick = () => document.body.removeChild(popup);
            document.getElementById("reloadPage").onclick = () => location.reload();
          })
      } catch (err) {
        console.error("‚ùå L·ªói t·∫°o ·∫£nh:", err);
        loaderWrapper.style.display = "none";
        alert("Kh√¥ng th·ªÉ t·∫°o ·∫£nh, vui l√≤ng th·ª≠ l·∫°i!");
      } finally {
      }
    });
  </script>

</html>